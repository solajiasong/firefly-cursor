<!DOCTYPE html>
<html lang="en">

<head>
    <title>three.js - gpu particle system</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #ffffff;
            margin: 0px;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="./three.min.js"></script>
    <script src="./GPUParticleSystem.js"></script>

    <script>
        //create overlay and set style
        jQuery('body').prepend('<div id="particleOverlay"><canvas id="myCanvas"></canvas></div>');
        jQuery('#particleOverlay').css('position', 'absolute').css('top', '0px').css('pointer-events', 'none').css('z-index', 1000);

        //Add perlin noise
        function randomNoise(canvas, x, y, width, height, alpha) {
            x = x || 0;
            y = y || 0;
            width = width || canvas.width;
            height = height || canvas.height;
            alpha = alpha || 255;
            var g = canvas.getContext("2d"),
                imageData = g.getImageData(x, y, width, height),
                random = Math.random,
                pixels = imageData.data,
                n = pixels.length,
                i = 0;
            while (i < n) {
                pixels[i++] = pixels[i++] = pixels[i++] = (random() * 256) | 0;
                pixels[i++] = alpha;
            }
            g.putImageData(imageData, x, y);
            return canvas;
        }

        function perlinNoise(canvas, noise) {
            noise = noise || randomNoise(canvas);
            var g = canvas.getContext("2d");
            g.save();

            /* Scale random iterations onto the canvas to generate Perlin noise. */
            for (var size = 4; size <= noise.width; size *= 2) {
                var x = (Math.random() * (noise.width - size)) | 0,
                    y = (Math.random() * (noise.height - size)) | 0;
                g.globalAlpha = 4 / size;
                g.drawImage(noise, x, y, size, size, 0, 0, canvas.width, canvas.height);
            }

            g.restore();

            console.log(canvas)

            return canvas;
        }

        function generateNoiseTemplate() {
            var canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;

            return perlinNoise(canvas);
        }

        var canvas = document.getElementById("myCanvas");

        console.log(canvas)

        var ctx = canvas.getContext("2d");
        ctx = generateNoiseTemplate();
        console.log(ctx)


    </script>
</body>

</html>